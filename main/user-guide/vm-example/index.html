
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.vaccel.org/main/user-guide/vm-example/">
      
      
        <link rel="prev" href="../build-run-app/">
      
      
        <link rel="next" href="../remote-example/">
      
      
      <link rel="icon" href="../../img/vaccel-img-logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Running a vAccel application on a VM - vAccel</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/gh-style-anchor.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-a-vaccel-application-on-a-vm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="vAccel" class="md-header__button md-logo" aria-label="vAccel" data-md-component="logo">
      
  <img src="../../img/vaccel-logo-full.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            vAccel
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Running a vAccel application on a VM
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="vAccel" class="md-nav__button md-logo" aria-label="vAccel" data-md-component="logo">
      
  <img src="../../img/vaccel-logo-full.svg" alt="logo">

    </a>
    vAccel
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../building/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build &amp; Install from source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../binaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install from binary packages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build-run-app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build and run a vAccel application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Running a vAccel application on a VM
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Running a vAccel application on a VM
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-host" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the host
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparing the host">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-vaccel-rpc-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Installing vAccel RPC agent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-vm-artifacts" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the VM artifacts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#booting-a-vaccel-enabled-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Booting a vAccel-enabled VM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Booting a vAccel-enabled VM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firecracker" class="md-nav__link">
    <span class="md-ellipsis">
      Firecracker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-hypervisor" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud hypervisor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qemu" class="md-nav__link">
    <span class="md-ellipsis">
      QEMU
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QEMU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qemu-with-pci-support" class="md-nav__link">
    <span class="md-ellipsis">
      QEMU with PCI support
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qemu-microvm-nopci" class="md-nav__link">
    <span class="md-ellipsis">
      QEMU microVM, noPCI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-in" class="md-nav__link">
    <span class="md-ellipsis">
      Logging in
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-vaccel-rpc-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Running the vAccel RPC agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-application-on-the-guest" class="md-nav__link">
    <span class="md-ellipsis">
      Running the application on the guest
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remote-example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Run a vAccel application remotely
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../plugins/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Plugins
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../plugins/acceleration/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Acceleration
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Acceleration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/acceleration/torch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Torch Plugin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/acceleration/tvm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TVM Plugin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/acceleration/tf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tensorflow Plugin
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../language_bindings/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Framework & Language bindings
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Framework & Language bindings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python_bindings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tensorflow_bindings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tensorflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vaccel_go/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Go Bindings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../dev_guide/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vAccel User API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vAccel plugin API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../useful-docs/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Useful Docs
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Useful Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../useful-docs/pytorch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build and Install PyTorch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../useful-docs/tvm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build and Install TVM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../useful-docs/tf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build and Install Tensorflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../useful-docs/jetson/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build and Install Jetson-inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="running-a-vaccel-application-on-a-vm">Running a vAccel application on a VM<a class="headerlink" href="#running-a-vaccel-application-on-a-vm" title="Permanent link"></a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link"></a></h2>
<p>To run a vAccel application on a VM you have to use a suitable transport plugin.
The plugin components will handle the forwarding of the function call from the
guest (VM) to the host system. Since a transport plugin will essentially forward
a vAccel function call from one vAccel instance to another, a valid vAccel
installation is required for both the guest <strong>and</strong> the host system. A visual
representation of the execution flow is shown in Figure 1.</p>
<figure>
  <img src="/img/vaccel-vm-flow.png" width="800" align=left
    alt="VM application execution flow" />
  <figcaption>Figure 1. VM application execution flow</figcaption>
</figure>

<p>The easiest way to run a vAccel application on a VM is to use the <code>RPC</code> plugin.
This plugin leverages the VirtIO vSock device for guest-host communication
without requiring any kernel customization. Guest-host communication over vSock
is handled by the the vAccel <code>RPC</code> plugin (guest) and the vAccel RPC agent
(host). In order to use the <code>RPC</code> plugin the following components must be in
place:</p>
<ol>
<li><em>Host:</em> The vAccel RPC agent + vAccel + an acceleration plugin, to handle the
   forwarded calls and perform the actual acceleration</li>
<li><em>Guest:</em> vAccel + the <code>RPC</code> plugin, to forward the application calls</li>
</ol>
<h2 id="preparing-the-host">Preparing the host<a class="headerlink" href="#preparing-the-host" title="Permanent link"></a></h2>
<p>If you have not already installed vAccel, install it
<a href="../binaries/">from binaries</a> or <a href="../building/">from source</a>. The rest of this
guide assumes vAccel libraries exist in the standard library search paths.</p>
<h3 id="installing-vaccel-rpc-agent">Installing vAccel RPC agent<a class="headerlink" href="#installing-vaccel-rpc-agent" title="Permanent link"></a></h3>
<p>vAccel RPC agent will handle the RPC requests and forward calls to the host
vAccel instance. You can find more information on how to install the
<code>vaccel-rpc-agent</code> binary at the
<a href="../binaries/#install-vaccel-agent">relevant section</a>.</p>
<h2 id="preparing-the-vm-artifacts">Preparing the VM artifacts<a class="headerlink" href="#preparing-the-vm-artifacts" title="Permanent link"></a></h2>
<p>To boot a working VM you will need at least a kernel and rootfs image. The
<code>VirtIO</code> plugin artifacts are a good starting point for running a basic
vAccel-enabled VM. You can get them with:</p>
<pre><code class="language-sh">mkdir downloads

# Download the artifacts.
# You can replace `x86_64` with `aarch64` below for aarch64 VM artifacts
wget -P downloads \
    https://s3.nbfc.io/nbfc-assets/github/vaccel/plugins/virtio/rev/main/x86_64/debug/vaccel-virtio-latest-vm.tar.xz

# Extract all of them in the current directory
tar xfv downloads/vaccel-virtio-latest-vm.tar.xz
find -name &quot;virtio-accel*.tar.xz&quot; -exec tar xfv {} \;
rm virtio-accel*.tar.xz

# Optionally, rename files for simplicity in the next steps
for file in linux-*.config bzImage-* vmlinux-*; do
    new_name=$(echo &quot;$file&quot; | sed -E 's/-[0-9]+\.[0-9]+\.[0-9]+-/-/')
    mv &quot;$file&quot; &quot;$new_name&quot;
done
mv vmlinux-amd64-fc vmlinux
mv bzImage-amd64 bzImage
</code></pre>
<p>This should leave you with 3 sets of files in the current directory:</p>
<ul>
<li>A <code>rootfs.img</code> containing Ubuntu with a vAccel installation</li>
<li>A <code>vmlinux</code> and a <code>linux-amd64-fc.config</code> that correspond to a basic
  (uncompressed) Linux kernel image meant to be used with Firecracker</li>
<li>A <code>bzImage</code> and a <code>linux-amd64.config</code> that correspond to a basic (compressed)
  Linux kernel image meant to be used with other VMMs</li>
</ul>
<p>To use the <code>rootfs.img</code> you will need to install the <code>RPC</code> plugin:</p>
<pre><code class="language-sh"># Mount the image
mkdir temp
sudo mount rootfs.img temp

# Download and install the `RPC` plugin binaries.
# You can replace `x86_64` with `aarch64` below if you used the aarch64 VM
# artifacts
wget -P downloads \
    https://s3.nbfc.io/nbfc-assets/github/vaccel/plugins/rpc/rev/main/x86_64/release/vaccel-rpc-latest-bin.tar.gz
sudo tar xfv downloads/vaccel-rpc-latest-bin.tar.gz \
    --strip-components=2 -C ./temp/usr/local

# Comment out unnecessary fstab entries
sudo sed -i '/9p/s/^/#/' ./temp/etc/fstab

sudo umount temp
rm -r temp
</code></pre>
<p>Your current directory should look something like:</p>
<pre><code class="language-console">$ tree -L 1
.
├── bzImage
├── downloads
├── linux-amd64-fc.config
├── linux-amd64.config
├── rootfs.img
└── vmlinux

1 directory, 5 files
</code></pre>
<h2 id="booting-a-vaccel-enabled-vm">Booting a vAccel-enabled VM<a class="headerlink" href="#booting-a-vaccel-enabled-vm" title="Permanent link"></a></h2>
<p>With the required artifacts in place, you can run any of the VMMs we have
tested: <a href="#firecracker">Firecracker</a>, <a href="#cloud-hypervisor">Cloud Hypervisor</a> or
<a href="#qemu">QEMU</a>. You will need access to <code>/dev/kvm</code> so make sure that your user is
a member of the <code>kvm</code> group or launch the VM as the <code>root</code> user.</p>
<h3 id="firecracker">Firecracker<a class="headerlink" href="#firecracker" title="Permanent link"></a></h3>
<p>You can get the latest <a href="https://firecracker-microvm.github.io/">Firecracker</a>
release from the
<a href="https://github.com/firecracker-microvm/firecracker/releases/latest">official repo</a>.
Ie. to download and extract Firecracker v1.11.0 for amd64:</p>
<pre><code class="language-sh">wget -P downloads \
    https://github.com/firecracker-microvm/firecracker/releases/download/v1.11.0/firecracker-v1.11.0-x86_64.tgz
mkdir firecracker
tar xfv downloads/firecracker-v1.11.0-x86_64.tgz \
    --strip-components=1 -C firecracker

# Optionally, link to a common filename to simplify next steps
ln -s firecracker/firecracker-v1.11.0-x86_64 firecracker/firecracker
</code></pre>
<p>A json config is needed to boot a VM. You can download a sample config with:</p>
<pre><code class="language-sh">wget https://s3.nbfc.io/nbfc-assets/github/vaccelrt/vm-example/x86_64/fc/config_vsock.json
</code></pre>
<p>The updated current directory should look like:</p>
<pre><code class="language-console">$ tree -L 1
.
├── bzImage
├── config_vsock.json
├── downloads
├── firecracker
├── linux-amd64-fc.config
├── linux-amd64.config
├── rootfs.img
└── vmlinux

2 directories, 6 files
</code></pre>
<p><strong>Note</strong> If you have already run <code>firecracker</code> or these files exist for some
reason, ensure that <code>./fc.sock</code> and <code>/tmp/vaccel.sock</code> are cleaned up before
trying to launch the VM:</p>
<pre><code class="language-sh">rm fc.sock /tmp/vaccel.sock
</code></pre>
<p>If you do not, <code>firecracker</code> will fail with errors like:</p>
<pre><code class="language-console">2025-03-30T17:56:21.871223256 [anonymous-instance:main] Running Firecracker v1.11.0
2025-03-30T17:56:21.871393598 [anonymous-instance:main] RunWithApiError error: Failed to open the API socket at: fc.sock. Check that it is not already used.
Error: RunWithApi(FailedToBindSocket(&quot;fc.sock&quot;))
2025-03-30T17:56:21.871438293 [anonymous-instance:main] Firecracker exiting with error. exit_code=1
</code></pre>
<p>or</p>
<pre><code class="language-console">2025-03-30T17:55:39.607508767 [anonymous-instance:main] Running Firecracker v1.11.0
2025-03-30T17:55:39.608446159 [anonymous-instance:main] RunWithApiError error: Failed to build MicroVM from Json: Configuration for VMM from one single json failed: Vsock device error: Cannot create backend for vsock device: Error binding to the host-side Unix socket: Address in use (os error 98)
Error: RunWithApi(BuildFromJson(ParseFromJson(VsockDevice(CreateVsockBackend(UnixBind(Os { code: 98, kind: AddrInUse, message: &quot;Address in use&quot; }))))))
2025-03-30T17:55:39.608572227 [anonymous-instance:main] Firecracker exiting with error. exit_code=1
</code></pre>
<p>Finally, to launch the VM use:</p>
<pre><code class="language-console">$ ./firecracker/firecracker --api-sock fc.sock --config-file config_vsock.json
2025-03-30T18:14:06.845979099 [anonymous-instance:main] Running Firecracker v1.11.0
2025-03-30T18:14:06.866599137 [anonymous-instance:main] Artificially kick devices.
2025-03-30T18:14:06.866685961 [anonymous-instance:fc_vcpu 0] Received a VcpuEvent::Resume message with immediate_exit enabled. immediate_exit was disabled before proceeding
2025-03-30T18:14:06.866735354 [anonymous-instance:fc_vcpu 1] Received a VcpuEvent::Resume message with immediate_exit enabled. immediate_exit was disabled before proceeding
2025-03-30T18:14:06.866773907 [anonymous-instance:main] Successfully started microvm that was configured from one single json
[    0.000000] Linux version 6.1.132 (root@buildkitsandbox) (gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #1 SMP PREEMPT_DYNAMIC Sun Mar 30 00:13:16 UTC 2025
[    0.000000] Command line: console=ttyS0 reboot=k panic=1 pci=off loglevel=8 root=/dev/vda random.trust_cpu=on root=/dev/vda rw virtio_mmio.device=4K@0xd0000000:5 virtio_mmio.device=4K@0xd0001000:6
[...]
[    0.448265] EXT4-fs (vda): mounted filesystem with ordered data mode. Quota mode: none.
[    0.449018] VFS: Mounted root (ext4 filesystem) on device 254:0.
[    0.450006] devtmpfs: mounted
[    0.450969] Freeing unused kernel image (initmem) memory: 2476K
[    0.451506] Write protecting the kernel read-only data: 18432k
[    0.453970] Freeing unused kernel image (text/rodata gap) memory: 2044K
[    0.457003] Freeing unused kernel image (rodata/data gap) memory: 1564K
[    0.457615] Run /sbin/init as init process
[    0.458012]   with arguments:
[    0.458293]     /sbin/init
[    0.458548]   with environment:
[    0.458845]     HOME=/
[    0.459071]     TERM=linux
SELinux:  Could not open policy file &lt;= /etc/selinux/targeted/policy/policy.33:  No such file or directory
[    0.496211] systemd[1]: systemd 255.4-1ubuntu8.5 running in system mode (+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMACK +SECCOMP +GCRYPT -GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS +FIDO2 +IDN2 -IDN +IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY +P11KIT +QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK -XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified)
[    0.499091] systemd[1]: Detected virtualization kvm.
[    0.499603] systemd[1]: Detected architecture x86-64.

Welcome to Ubuntu 24.04.1 LTS!

[...]
[  OK  ] Started getty@tty1.service - Getty on tty1.
[  OK  ] Started getty@tty2.service - Getty on tty2.
[  OK  ] Started getty@tty3.service - Getty on tty3.
[  OK  ] Started getty@tty4.service - Getty on tty4.
[  OK  ] Started getty@tty5.service - Getty on tty5.
[  OK  ] Started getty@tty6.service - Getty on tty6.
[  OK  ] Started serial-getty@ttyS0.service - Serial Getty on ttyS0.
[  OK  ] Reached target getty.target - Login Prompts.
[  OK  ] Reached target multi-user.target - Multi-User System.
[  OK  ] Reached target graphical.target - Graphical Interface.
         Starting systemd-update-utmp-runle…- Record Runlevel Change in UTMP...
[  OK  ] Finished systemd-update-utmp-runle…e - Record Runlevel Change in UTMP.

Ubuntu 24.04.1 LTS localhost.localdomain ttyS0

localhost login:
</code></pre>
<p>To continue proceed to <a href="#logging-in">Logging In</a>.</p>
<h3 id="cloud-hypervisor">Cloud hypervisor<a class="headerlink" href="#cloud-hypervisor" title="Permanent link"></a></h3>
<p>You can get the latest <a href="https://www.cloudhypervisor.org/">Cloud Hypervisor</a>
release from the
<a href="https://github.com/cloud-hypervisor/cloud-hypervisor/releases/latest">official repo</a>.
Ie. to download v44.0 for amd64:</p>
<pre><code class="language-sh">wget -O cloud-hypervisor \
    https://github.com/cloud-hypervisor/cloud-hypervisor/releases/download/v44.0/cloud-hypervisor-static
chmod u+x cloud-hypervisor
</code></pre>
<p>The updated current directory should look like:</p>
<pre><code class="language-console">$ tree -L 1
.
├── bzImage
├── cloud-hypervisor
├── downloads
├── linux-amd64-fc.config
├── linux-amd64.config
├── rootfs.img
└── vmlinux

1 directory, 6 files
</code></pre>
<p>To launch the VM you can use:</p>
<pre><code class="language-console">$ ./cloud-hypervisor --kernel bzImage --disk path=rootfs.img \
      --cpus boot=2 --memory size=4096M \
      --cmdline &quot;console=ttyS0 root=/dev/vda rw&quot; \
      --console off --serial tty \
      --vsock cid=42,socket=/tmp/vaccel.sock
[    0.000000] Linux version 6.1.132 (root@buildkitsandbox) (gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #1 SMP PREEMPT_DYNAMIC Sun Mar 30 00:13:19 UTC 2025
[    0.000000] Command line: console=ttyS0 root=/dev/vda rw
[...]
[    0.582493] EXT4-fs (vda): mounted filesystem with ordered data mode. Quota mode: none.
[    0.583313] VFS: Mounted root (ext4 filesystem) on device 254:0.
[    0.584241] devtmpfs: mounted
[    0.585398] Freeing unused kernel image (initmem) memory: 2484K
[    0.586013] Write protecting the kernel read-only data: 20480k
[    0.588863] Freeing unused kernel image (text/rodata gap) memory: 2044K
[    0.591116] Freeing unused kernel image (rodata/data gap) memory: 1524K
[    0.591787] Run /sbin/init as init process
SELinux:  Could not open policy file &lt;= /etc/selinux/targeted/policy/policy.33:  No such file or directory
[    0.623287] systemd[1]: systemd 255.4-1ubuntu8.5 running in system mode (+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMACK +SECCOMP +GCRYPT -GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS +FIDO2 +IDN2 -IDN +IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY +P11KIT +QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK -XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified)
[    0.626523] systemd[1]: Detected virtualization kvm.
[    0.627092] systemd[1]: Detected architecture x86-64.

Welcome to Ubuntu 24.04.1 LTS!

[...]
[  OK  ] Started getty@tty1.service - Getty on tty1.
[  OK  ] Started getty@tty2.service - Getty on tty2.
[  OK  ] Started getty@tty3.service - Getty on tty3.
[  OK  ] Started getty@tty4.service - Getty on tty4.
[  OK  ] Started getty@tty5.service - Getty on tty5.
[  OK  ] Started getty@tty6.service - Getty on tty6.
[  OK  ] Started serial-getty@ttyS0.service - Serial Getty on ttyS0.
[  OK  ] Reached target getty.target - Login Prompts.
[  OK  ] Reached target multi-user.target - Multi-User System.
[  OK  ] Reached target graphical.target - Graphical Interface.
         Starting systemd-update-utmp-runle…- Record Runlevel Change in UTMP...
[  OK  ] Finished systemd-update-utmp-runle…e - Record Runlevel Change in UTMP.

Ubuntu 24.04.1 LTS localhost.localdomain ttyS0

localhost login:
</code></pre>
<p>To continue proceed to <a href="#logging-in">Logging In</a>.</p>
<h3 id="qemu">QEMU<a class="headerlink" href="#qemu" title="Permanent link"></a></h3>
<p>To install <a href="https://www.qemu.org/">QEMU</a> you can use your distribution's package
manager:</p>
<pre><code class="language-sh">sudo apt install qemu
</code></pre>
<p>QEMU can emulate different machines. We will show how to boot with two common
machine options.</p>
<h4 id="qemu-with-pci-support">QEMU with PCI support<a class="headerlink" href="#qemu-with-pci-support" title="Permanent link"></a></h4>
<p>If no machine is provided, QEMU will emulate the default machine depending on
the platform architecture. For x86_64 this is a machine with PCI support.</p>
<p>To launch a QEMU VM with PCI support use:</p>
<pre><code class="language-console">$ qemu-system-x86_64 -M pc,accel=kvm -cpu host \
      -nographic -vga none -nic none \
      -smp 2 -m 4096 \
      -kernel bzImage \
      -append &quot;console=ttyS0 earlyprintk=ttyS0 root=/dev/vda rw &quot; \
      -drive if=none,id=rootfs,file=rootfs.img,format=raw,cache=none \
      -device virtio-blk,drive=rootfs \
      -device vhost-vsock-pci,id=vhost-vsock-pci0,guest-cid=42
SeaBIOS (version rel-1.16.3-0-ga6ed6b701f0a-prebuilt.qemu.org)
Booting from ROM..
early console in extract_kernel
input_data: 0x00000000024c52c4
input_len: 0x00000000007949f9
output: 0x0000000001000000
output_len: 0x0000000001c1ceb8
kernel_total_size: 0x0000000001a2c000
needed_size: 0x0000000001e00000
trampoline_32bit: 0x0000000000000000
Physical KASLR using RDRAND RDTSC...
Virtual KASLR using RDRAND RDTSC...

Decompressing Linux... Parsing ELF... Performing relocations... done.
Booting the kernel (entry_offset: 0x0000000000000000).
[    0.000000] Linux version 6.1.132 (root@buildkitsandbox) (gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #1 SMP PREEMPT_DYNAMIC Sun Mar 30 00:13:19 UTC 2025
[    0.000000] Command line: console=ttyS0 root=/dev/vda rw
[...]
[    0.582493] EXT4-fs (vda): mounted filesystem with ordered data mode. Quota mode: none.
[    0.583313] VFS: Mounted root (ext4 filesystem) on device 254:0.
[    0.584241] devtmpfs: mounted
[    0.585398] Freeing unused kernel image (initmem) memory: 2484K
[    0.586013] Write protecting the kernel read-only data: 20480k
[    0.588863] Freeing unused kernel image (text/rodata gap) memory: 2044K
[    0.591116] Freeing unused kernel image (rodata/data gap) memory: 1524K
[    0.591787] Run /sbin/init as init process
SELinux:  Could not open policy file &lt;= /etc/selinux/targeted/policy/policy.33:  No such file or directory
[    0.623287] systemd[1]: systemd 255.4-1ubuntu8.5 running in system mode (+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMACK +SECCOMP +GCRYPT -GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS +FIDO2 +IDN2 -IDN +IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY +P11KIT +QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK -XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified)
[    0.626523] systemd[1]: Detected virtualization kvm.
[    0.627092] systemd[1]: Detected architecture x86-64.

Welcome to Ubuntu 24.04.1 LTS!

[...]
[  OK  ] Started getty@tty1.service - Getty on tty1.
[  OK  ] Started getty@tty2.service - Getty on tty2.
[  OK  ] Started getty@tty3.service - Getty on tty3.
[  OK  ] Started getty@tty4.service - Getty on tty4.
[  OK  ] Started getty@tty5.service - Getty on tty5.
[  OK  ] Started getty@tty6.service - Getty on tty6.
[  OK  ] Started serial-getty@ttyS0.service - Serial Getty on ttyS0.
[  OK  ] Reached target getty.target - Login Prompts.
[  OK  ] Reached target multi-user.target - Multi-User System.
[  OK  ] Reached target graphical.target - Graphical Interface.
         Starting systemd-update-utmp-runle…- Record Runlevel Change in UTMP...
[  OK  ] Finished systemd-update-utmp-runle…e - Record Runlevel Change in UTMP.

Ubuntu 24.04.1 LTS localhost.localdomain ttyS0

localhost login:
</code></pre>
<p>To continue proceed to <a href="#logging-in">Logging In</a>.</p>
<h4 id="qemu-microvm-nopci">QEMU microVM, noPCI<a class="headerlink" href="#qemu-microvm-nopci" title="Permanent link"></a></h4>
<p>Current versions of QEMU provide a microVM machine with no PCI support, meant to
be used as a lightweight alternative to the default machine. This target aims to
provide and experience similar to Firecracker.</p>
<p>To launch a QEMU microVM (with no PCI support) use:</p>
<pre><code class="language-console">$ qemu-system-x86_64 -M microvm,accel=kvm -cpu host \
      -nographic -vga none -nic none \
      -smp 2 -m 4096 \
      -kernel bzImage \
      -append &quot;console=ttyS0 earlyprintk=ttyS0 root=/dev/vda rw &quot; \
      -drive if=none,id=rootfs,file=rootfs.img,format=raw,cache=none \
      -device virtio-blk-device,drive=rootfs \
      -device vhost-vsock-device,id=vhost-vsock,guest-cid=42
SeaBIOS (version rel-1.16.3-0-ga6ed6b701f0a-prebuilt.qemu.org)
Booting from ROM..
early console in extract_kernel
input_data: 0x00000000024c52c4
input_len: 0x00000000007949f9
output: 0x0000000001000000
output_len: 0x0000000001c1ceb8
kernel_total_size: 0x0000000001a2c000
needed_size: 0x0000000001e00000
trampoline_32bit: 0x0000000000000000
Physical KASLR using RDRAND RDTSC...
Virtual KASLR using RDRAND RDTSC...

Decompressing Linux... Parsing ELF... Performing relocations... done.
Booting the kernel (entry_offset: 0x0000000000000000).
[    0.000000] Linux version 6.1.132 (root@buildkitsandbox) (gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #1 SMP PREEMPT_DYNAMIC Sun Mar 30 00:13:19 UTC 2025
[    0.000000] Command line: console=ttyS0 earlyprintk=ttyS0 root=/dev/vda rw
[...]
[    0.203882] VFS: Mounted root (ext4 filesystem) on device 254:0.
[    0.205666] devtmpfs: mounted
[    0.206459] Freeing unused kernel image (initmem) memory: 2484K
[    0.207052] Write protecting the kernel read-only data: 20480k
[    0.208129] Freeing unused kernel image (text/rodata gap) memory: 2044K
[    0.209050] Freeing unused kernel image (rodata/data gap) memory: 1524K
[    0.209702] Run /sbin/init as init process
SELinux:  Could not open policy file &lt;= /etc/selinux/targeted/policy/policy.33:  No such file or directory
[    0.316715] systemd[1]: systemd 255.4-1ubuntu8.5 running in system mode (+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMAC)
[    0.319763] systemd[1]: Detected virtualization kvm.
[    0.320270] systemd[1]: Detected architecture x86-64.

Welcome to Ubuntu 24.04.1 LTS!

[...]
[  OK  ] Started getty@tty1.service - Getty on tty1.
[  OK  ] Started getty@tty2.service - Getty on tty2.
[  OK  ] Started getty@tty3.service - Getty on tty3.
[  OK  ] Started getty@tty4.service - Getty on tty4.
[  OK  ] Started getty@tty5.service - Getty on tty5.
[  OK  ] Started getty@tty6.service - Getty on tty6.
[  OK  ] Started serial-getty@ttyS0.service - Serial Getty on ttyS0.
[  OK  ] Reached target getty.target - Login Prompts.
[  OK  ] Reached target multi-user.target - Multi-User System.
[  OK  ] Reached target graphical.target - Graphical Interface.
         Starting systemd-update-utmp-runle…- Record Runlevel Change in UTMP...
[  OK  ] Finished systemd-update-utmp-runle…e - Record Runlevel Change in UTMP.

Ubuntu 24.04.1 LTS localhost.localdomain ttyS0

localhost login:
</code></pre>
<h3 id="logging-in">Logging in<a class="headerlink" href="#logging-in" title="Permanent link"></a></h3>
<p>Since the provided image is meant for testing purposes the default user is
<code>root</code>. To log in use <code>root</code> (no password required). You should be greeted with:</p>
<pre><code class="language-console">Welcome to Ubuntu 24.04.1 LTS (GNU/Linux 6.1.132 x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

root@localhost:~#
</code></pre>
<p>You can verify all required libraries are installed by looking at
<code>/usr/local/lib/x86_64-linux-gnu</code>:</p>
<pre><code class="language-console"># ls /usr/local/lib/x86_64-linux-gnu/
libmytestlib.so            libvaccel-noop.so.0        libvaccel-virtio.so
libvaccel-exec.so          libvaccel-noop.so.0.6.1    libvaccel-virtio.so.0
libvaccel-exec.so.0        libvaccel-python.so        libvaccel-virtio.so.0.1.0
libvaccel-exec.so.0.6.1    libvaccel-python.so.0      libvaccel.so
libvaccel-mbench.so        libvaccel-python.so.0.6.1  libvaccel.so.0
libvaccel-mbench.so.0      libvaccel-rpc.so           libvaccel.so.0.6.1
libvaccel-mbench.so.0.6.1  libvaccel-rpc.so.0         pkgconfig
libvaccel-noop.so          libvaccel-rpc.so.0.1.0
</code></pre>
<h2 id="running-the-vaccel-rpc-agent">Running the vAccel RPC agent<a class="headerlink" href="#running-the-vaccel-rpc-agent" title="Permanent link"></a></h2>
<p>Before running a vAccel application on the guest, you need to first start the
vAccel RPC agent. Since the VM console should be open in the current terminal by
now, you will have to open a new terminal to execute the agent.</p>
<p>Depending on the VMM being used, you have to set a valid RPC address for the
agent. Firecracker and Cloud Hypervisor use a "hybrid" <code>unix</code> socket for vSock
communication, while QEMU expects a proper <code>vsock</code> socket.</p>
<p>To use <code>vaccel-rpc-agent</code> for the above Firecracker/Cloud Hypervisor setups use:</p>
<pre><code class="language-sh">export VACCEL_RPC_ADDRESS=&quot;unix:///tmp/vaccel.sock_2048&quot;
</code></pre>
<p>where <code>/tmp/vaccel.sock</code> is the VMM's vsock socket we have configured in the
previous steps.</p>
<p>For QEMU, the variable should be set to:</p>
<pre><code class="language-sh">export VACCEL_RPC_ADDRESS=&quot;vsock://2:2048&quot;
</code></pre>
<p>where <code>2</code> is the well-known vSock address of the host.</p>
<p>For both cases, <code>2048</code> is the port number we have configured in the previous
steps for the VMM.</p>
<p>Since the agent will instantiate the host vAccel, you also need to configure
vAccel in this step. You can configure vAccel by setting the related environment
variables - as you would do for a plugin - or you can use the
<code>vaccel-rpc-agent</code>'s CLI (preferred).</p>
<p>Since the 'NoOp' plugin is included with vAccel, we will use this as the
acceleration plugin for demonstration purposes.</p>
<p>To start a <code>vaccel-rpc-agent</code> with the vAccel <code>NoOp</code> plugin use:</p>
<pre><code class="language-console">$ VACCEL_BOOTSTRAP_ENABLED=0 vaccel-rpc-agent \
      -a &quot;${VACCEL_RPC_ADDRESS}&quot; \
      --vaccel-config &quot;plugins=libvaccel-noop.so,log_level=4&quot;
2025.04.08-19:34:05.40 - &lt;debug&gt; Initializing vAccel
2025.04.08-19:34:05.40 - &lt;info&gt; vAccel 0.6.1-194-19056528
2025.04.08-19:34:05.40 - &lt;debug&gt; Config:
2025.04.08-19:34:05.40 - &lt;debug&gt;   plugins = libvaccel-noop.so
2025.04.08-19:34:05.40 - &lt;debug&gt;   log_level = debug
2025.04.08-19:34:05.40 - &lt;debug&gt;   log_file = (null)
2025.04.08-19:34:05.40 - &lt;debug&gt;   profiling_enabled = false
2025.04.08-19:34:05.40 - &lt;debug&gt;   version_ignore = false
2025.04.08-19:34:05.40 - &lt;debug&gt; Created top-level rundir: /run/user/1002/vaccel/j1Kwrv
2025.04.08-19:34:05.40 - &lt;info&gt; Registered plugin noop 0.6.1-194-19056528
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op noop from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op blas_sgemm from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op image_classify from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op image_detect from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op image_segment from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op image_pose from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op image_depth from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op exec from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op tf_session_load from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op tf_session_run from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op tf_session_delete from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op minmax from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op fpga_arraycopy from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op fpga_vectoradd from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op fpga_parallel from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op fpga_mmult from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op exec_with_resource from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op torch_jitload_forward from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op torch_sgemm from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op opencv from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op tflite_session_load from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op tflite_session_run from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Registered op tflite_session_delete from plugin noop
2025.04.08-19:34:05.40 - &lt;debug&gt; Loaded plugin noop from libvaccel-noop.so
[2025-04-08T19:34:05Z INFO  ttrpc::sync::server] server listen started
[2025-04-08T19:34:05Z INFO  ttrpc::sync::server] server started
[2025-04-08T19:34:05Z INFO  vaccel_rpc_agent] vAccel RPC agent started
[2025-04-08T19:34:05Z INFO  vaccel_rpc_agent] Listening on 'vsock://2:2048', press Ctrl+C to exit
</code></pre>
<h2 id="running-the-application-on-the-guest">Running the application on the guest<a class="headerlink" href="#running-the-application-on-the-guest" title="Permanent link"></a></h2>
<p>With the vAccel RPC agent running, you are ready to execute the application in
the VM.</p>
<p>Switching back to the initial terminal, you need to first configure the RPC
address that will be used by the plugin:</p>
<pre><code class="language-sh">export VACCEL_RPC_ADDRESS=&quot;vsock://2:2048&quot;
</code></pre>
<p>where <code>2</code> is the well-known vSock address of the host and this address is common
for all the VMMs we have setup above.</p>
<p>Next, you have to configure vAccel to use the plugin:</p>
<pre><code class="language-sh">export VACCEL_PLUGINS=libvaccel-rpc.so
</code></pre>
<p>Optionally, to get debug output:</p>
<pre><code class="language-sh">export VACCEL_LOG_LEVEL=4
</code></pre>
<p>Finally, you can run an image classification example with:</p>
<pre><code class="language-console"># classify /usr/local/share/vaccel/images/example.jpg 1
2025.04.08-19:34:48.28 - &lt;debug&gt; Initializing vAccel
2025.04.08-19:34:48.28 - &lt;info&gt; vAccel 0.6.1-194-19056528
2025.04.08-19:34:48.28 - &lt;debug&gt; Config:
2025.04.08-19:34:48.28 - &lt;debug&gt;   plugins = libvaccel-rpc.so
2025.04.08-19:34:48.28 - &lt;debug&gt;   log_level = debug
2025.04.08-19:34:48.28 - &lt;debug&gt;   log_file = (null)
2025.04.08-19:34:48.28 - &lt;debug&gt;   profiling_enabled = false
2025.04.08-19:34:48.28 - &lt;debug&gt;   version_ignore = false
2025.04.08-19:34:48.28 - &lt;debug&gt; Created top-level rundir: /run/user/0/vaccel/JE4UiS
2025.04.08-19:34:48.30 - &lt;info&gt; Registered plugin rpc 0.1.0-36-bbffdae6
2025.04.08-19:34:48.30 - &lt;debug&gt; rpc is a VirtIO module
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op blas_sgemm from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op image_classify from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op image_detect from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op image_segment from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op image_depth from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op image_pose from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op tflite_session_load from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op tflite_session_delete from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op tflite_session_run from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op minmax from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op fpga_arraycopy from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op fpga_mmult from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op fpga_vectoradd from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op fpga_parallel from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op exec from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op exec_with_resource from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op torch_jitload_forward from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op opencv from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op tf_session_load from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op tf_session_delete from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Registered op tf_session_run from plugin rpc
2025.04.08-19:34:48.30 - &lt;debug&gt; Loaded plugin rpc from libvaccel-rpc.so
2025.04.08-19:34:48.31 - &lt;debug&gt; [rpc] Initializing new remote session
2025.04.08-19:34:48.34 - &lt;debug&gt; [rpc] Initialized remote session 1
2025.04.08-19:34:48.34 - &lt;debug&gt; New rundir for session 1: /run/user/0/vaccel/JE4UiS/session.1
2025.04.08-19:34:48.34 - &lt;debug&gt; Initialized session 1 with remote (id: 1)
Initialized session with id: 1
2025.04.08-19:34:48.34 - &lt;debug&gt; session:1 Looking for plugin implementing VACCEL_OP_IMAGE_CLASSIFY
2025.04.08-19:34:48.34 - &lt;debug&gt; Returning func from hint plugin rpc
2025.04.08-19:34:48.34 - &lt;debug&gt; Found implementation in rpc plugin
classification tags: This is a dummy classification tag!
classification imagename: This is a dummy imgname!
2025.04.08-19:34:48.35 - &lt;debug&gt; [rpc] Releasing remote session 1
2025.04.08-19:34:48.35 - &lt;debug&gt; Released session 1
2025.04.08-19:34:48.35 - &lt;debug&gt; Cleaning up vAccel
2025.04.08-19:34:48.35 - &lt;debug&gt; Cleaning up sessions
2025.04.08-19:34:48.35 - &lt;debug&gt; Cleaning up resources
2025.04.08-19:34:48.35 - &lt;debug&gt; Cleaning up plugins
2025.04.08-19:34:48.35 - &lt;debug&gt; Unregistered plugin rpc
</code></pre>
<p>In the other terminal, where the vAccel RPC agent is running, you should also
see the corresponding host vAccel output:</p>
<pre><code class="language-console">2025.04.08-19:34:48.36 - &lt;debug&gt; New rundir for session 1: /run/user/1002/vaccel/j1Kwrv/session.1
2025.04.08-19:34:48.36 - &lt;debug&gt; Initialized session 1
[2025-04-08T19:34:48Z INFO  vaccel_rpc_agent::session] Created session 1
[2025-04-08T19:34:48Z INFO  vaccel_rpc_agent::ops::genop] Genop session 1
2025.04.08-19:34:48.37 - &lt;debug&gt; session:1 Looking for plugin implementing VACCEL_OP_IMAGE_CLASSIFY
2025.04.08-19:34:48.37 - &lt;debug&gt; Returning func from hint plugin noop
2025.04.08-19:34:48.37 - &lt;debug&gt; Found implementation in noop plugin
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] Calling Image classification for session 1
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] Dumping arguments for Image classification:
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] model: (null)
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] len_img: 79281
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] len_out_text: 512
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] len_out_imgname: 512
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] will return a dummy result
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] will return a dummy result
2025.04.08-19:34:48.38 - &lt;debug&gt; Released session 1
[2025-04-08T19:34:48Z INFO  vaccel_rpc_agent::session] Destroyed session 1
</code></pre>
<p>If you compare the application output with the
<a href="../build-run-app/#running-a-vaccel-application">native execution case</a> ignoring
the vAccel log messages, you will notice that it is identical:</p>
<pre><code class="language-console"># classify /usr/local/share/vaccel/images/example.jpg 1
...
Initialized session with id: 1
...
classification tags: This is a dummy classification tag!
classification imagename: This is a dummy imgname!
...
</code></pre>
<p>The debug log messages reveal that in the native execution case the <code>NoOp</code>
plugin is used directly:</p>
<pre><code class="language-console"># FIXME
</code></pre>
<p>whereas in the VM case, the <code>RPC</code> plugin is used on the guest:</p>
<pre><code class="language-console"># classify /usr/local/share/vaccel/images/example.jpg 1
2025.04.08-19:34:48.28 - &lt;debug&gt; Initializing vAccel
2025.04.08-19:34:48.28 - &lt;info&gt; vAccel 0.6.1-194-19056528
2025.04.08-19:34:48.28 - &lt;debug&gt; Config:
2025.04.08-19:34:48.28 - &lt;debug&gt;   plugins = libvaccel-rpc.so
2025.04.08-19:34:48.28 - &lt;debug&gt;   log_level = debug
2025.04.08-19:34:48.28 - &lt;debug&gt;   log_file = (null)
2025.04.08-19:34:48.28 - &lt;debug&gt;   profiling_enabled = false
2025.04.08-19:34:48.28 - &lt;debug&gt;   version_ignore = false
2025.04.08-19:34:48.28 - &lt;debug&gt; Created top-level rundir: /run/user/0/vaccel/JE4UiS
2025.04.08-19:34:48.30 - &lt;info&gt; Registered plugin rpc 0.1.0-36-bbffdae6
...
2025.04.08-19:34:48.30 - &lt;debug&gt; Loaded plugin rpc from libvaccel-rpc.so
2025.04.08-19:34:48.31 - &lt;debug&gt; [rpc] Initializing new remote session
2025.04.08-19:34:48.34 - &lt;debug&gt; [rpc] Initialized remote session 1
...
2025.04.08-19:34:48.34 - &lt;debug&gt; Returning func from hint plugin rpc
2025.04.08-19:34:48.34 - &lt;debug&gt; Found implementation in rpc plugin
...
2025.04.08-19:34:48.35 - &lt;debug&gt; [rpc] Releasing remote session 1
...
</code></pre>
<p>while the <code>NoOp</code> plugin is used on the host:</p>
<pre><code class="language-console">2025.04.08-19:34:05.40 - &lt;debug&gt; Initializing vAccel
2025.04.08-19:34:05.40 - &lt;info&gt; vAccel 0.6.1-194-19056528
2025.04.08-19:34:05.40 - &lt;debug&gt; Config:
2025.04.08-19:34:05.40 - &lt;debug&gt;   plugins = libvaccel-noop.so
2025.04.08-19:34:05.40 - &lt;debug&gt;   log_level = debug
2025.04.08-19:34:05.40 - &lt;debug&gt;   log_file = (null)
2025.04.08-19:34:05.40 - &lt;debug&gt;   profiling_enabled = false
2025.04.08-19:34:05.40 - &lt;debug&gt;   version_ignore = false
2025.04.08-19:34:05.40 - &lt;debug&gt; Created top-level rundir: /run/user/1002/vaccel/j1Kwrv
2025.04.08-19:34:05.40 - &lt;info&gt; Registered plugin noop 0.6.1-194-19056528
...
2025.04.08-19:34:05.40 - &lt;debug&gt; Loaded plugin noop from libvaccel-noop.so
...
2025.04.08-19:34:48.37 - &lt;debug&gt; Returning func from hint plugin noop
2025.04.08-19:34:48.37 - &lt;debug&gt; Found implementation in noop plugin
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] Calling Image classification for session 1
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] Dumping arguments for Image classification:
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] model: (null)
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] len_img: 79281
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] len_out_text: 512
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] len_out_imgname: 512
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] will return a dummy result
2025.04.08-19:34:48.37 - &lt;debug&gt; [noop] will return a dummy result
...
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2018 - 2025 Nubificus LTD
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.sections", "navigation.expand", "navigation.tracking", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"alias": true, "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>